
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="GSD test4">
      
      
        <meta name="author" content="David Caddick">
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.6">
    
    
      
        <title>MDI - Get Security Done - Test 4</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.558e4712.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.2505c338.min.css">
      
      
  
  
    
    
  
  
  <style>:root{--md-admonition-icon--<type>:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"/></svg>');}</style>


    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="green">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#ways-of-working" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Get Security Done - Test 4" class="md-header__button md-logo" aria-label="Get Security Done - Test 4" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Get Security Done - Test 4
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              MDI
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="green"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
            </label>
          
        
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="cyan" data-md-color-accent="cyan"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/dcaddick/gsd_test4" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    dcaddick/gsd_test4
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Get Security Done - Test 4" class="md-nav__button md-logo" aria-label="Get Security Done - Test 4" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Get Security Done - Test 4
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/dcaddick/gsd_test4" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    dcaddick/gsd_test4
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../README.md" class="md-nav__link">
        Home
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#ways-of-working" class="md-nav__link">
    Ways of working
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#enable-telemetry" class="md-nav__link">
    Enable Telemetry
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#validate-and-test" class="md-nav__link">
    Validate and Test
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#enable-reporting" class="md-nav__link">
    Enable Reporting
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#review-and-improve-as-needed" class="md-nav__link">
    Review and Improve as needed
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting" class="md-nav__link">
    Troubleshooting
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  



  <h1>MDI</h1>

<p><img alt="" src="https://learn.microsoft.com/en-us/defender-for-identity/media/architecture-topology.png" /></p>
<h2 id="ways-of-working">Ways of working</h2>
<p>First decision point - do you have <strong>ANY</strong> Domain Controllers within your environment? If so then you should install MDI <strong>NOW</strong> and make it the very top of your Security ToDo list.</p>
<p>Example of <strong>WHY</strong> you do this first:</p>
<ul>
<li>Small Customer in 2018, back when this was called "Azure ATP", installed only as a PoC and in under 48 hours it had identified a mis-configured Server that was exposed to the internet and was being brute-forced via RDP from Eastern Europe.</li>
<li>Larger environment 2020, client not sure but was wanting to lock down Legacy Auth, suggested that as they had E5 <strong>strong recommendation</strong> to deploy MDI ASAP across DC's. After getting CAB Approval to deploy, and with less than 10% coverage of DC's in just over a week it popped up with "NTDIS Exfil via SMB"</li>
<li>Security Value = <strong>Priceless</strong></li>
</ul>
<h2 id="enable-telemetry">Enable Telemetry</h2>
<p>Start here - <a href="https://learn.microsoft.com/en-us/defender-for-identity/prerequisites">https://learn.microsoft.com/en-us/defender-for-identity/prerequisites</a></p>
<ol>
<li>Capacity planning - <a href="https://learn.microsoft.com/en-us/defender-for-identity/capacity-planning">https://learn.microsoft.com/en-us/defender-for-identity/capacity-planning</a></li>
<li>Download the Sizing tool - <a href="https://github.com/microsoft/ATA-AATP-Sizing-Tool/releases">https://github.com/microsoft/ATA-AATP-Sizing-Tool/releases</a></li>
<li>Download the Sensor - <a href="https://learn.microsoft.com/en-us/defender-for-identity/download-sensor">https://learn.microsoft.com/en-us/defender-for-identity/download-sensor</a></li>
<li>Install the Sensor on DC's - <a href="https://learn.microsoft.com/en-us/defender-for-identity/install-sensor">https://learn.microsoft.com/en-us/defender-for-identity/install-sensor</a></li>
<li>Basic Settings that you should review <strong>NOW</strong> - <a href="https://www.microsoft.com/videoplayer/embed/RWFVEX">https://www.microsoft.com/videoplayer/embed/RWFVEX</a></li>
</ol>
<p>This will do for now, especially if you are in a crisis mode, check the console for the DC's being online - now move on to validation below.
Please follow up with all other Configuration steps as soon as practible, especially if you also have ADFS in play. 
For ADFS please also check - <a href="https://learn.microsoft.com/en-us/defender-for-identity/active-directory-federation-services">https://learn.microsoft.com/en-us/defender-for-identity/active-directory-federation-services</a></p>
<h2 id="validate-and-test">Validate and Test</h2>
<p>Be conscious that if you are testing that MDI is working correctly that this may trigger <strong>high impact</strong> Alerts to your Blue Team or existing SecOps IF it's already installed and being monitored - or for that matter if another tooling is in place to monitor the same behaviour - so if doing some major testing it's worthwhile letting them know before hand? And on that, make sure you schedule some time to review afterwards about what testing/alerting was created &amp; what was visible from a SecOps perspective? </p>
<p>This would be valuable lessons on effectiveness - even more so if there is missing alerts?? :( </p>
<ul>
<li>Specific Validation information - <a href="https://learn.microsoft.com/en-us/defender-for-identity/configure-sensor-settings#validate-installations">https://learn.microsoft.com/en-us/defender-for-identity/configure-sensor-settings#validate-installations</a></li>
<li>Make sure that Advanced Settings has Integration enabled - <a href="https://learn.microsoft.com/en-us/defender-for-identity/classic-integrate-mde">https://learn.microsoft.com/en-us/defender-for-identity/classic-integrate-mde</a></li>
<li>Make doubly sure this Integration is enabled between ALL elements of MDI, MDE, MDO, MDCA and the M365 Defender Console
<img alt="" src="https://learn.microsoft.com/en-us/defender-for-identity/media/msde-enable.png" /></li>
<li>Use Attack Simulations to <strong>validate MDI is installed correctly</strong> and Alerts are being surfaced accurately:
    <a href="https://learn.microsoft.com/en-us/defender-for-identity/playbooks">https://learn.microsoft.com/en-us/defender-for-identity/playbooks</a></li>
<li>Use Labs for <strong>in depth checking</strong>: <a href="https://learn.microsoft.com/en-us/defender-for-identity/playbook-lab-overview">https://learn.microsoft.com/en-us/defender-for-identity/playbook-lab-overview</a></li>
<li><a href="https://learn.microsoft.com/en-us/defender-for-identity/playbook-domain-dominance">https://learn.microsoft.com/en-us/defender-for-identity/playbook-domain-dominance</a></li>
<li>Go to <a href="https://portal.atp.azure.com">https://portal.atp.azure.com</a> and if you see this, it's not been installed correctly
<img alt="" src="./images/image3.png" /></li>
</ul>
<h2 id="enable-reporting">Enable Reporting</h2>
<p>Once enabled you should now have a lot more visibility into the Security Posture of the onPrem environment - including the following:</p>
<ul>
<li>Domain controllers with Print Spooler service available</li>
<li>Dormant entities in sensitive groups</li>
<li>Entities exposing credentials in clear text</li>
<li>Microsoft LAPS usage</li>
<li>Legacy protocols usage</li>
<li>Riskiest lateral movement paths (LMP)</li>
<li>Unmonitored domain controllers</li>
<li>Unsecure account attributes</li>
<li>Unsecure domain configurations</li>
<li>Unsecure Kerberos delegation</li>
<li>Unsecure SID History attributes</li>
<li>Weak cipher usage</li>
</ul>
<p>More details can be found here &amp; example below - <a href="https://learn.microsoft.com/en-us/defender-for-identity/security-assessment#assessment-reports">https://learn.microsoft.com/en-us/defender-for-identity/security-assessment#assessment-reports</a>
<img alt="" src="https://learn.microsoft.com/en-us/defender-for-identity/media/select-assessment.png" /></p>
<h2 id="review-and-improve-as-needed">Review and Improve as needed</h2>
<ul>
<li>Review Security Assessments to validate what potentially needs remediation: <a href="https://learn.microsoft.com/en-us/defender-for-identity/security-assessment#assessment-reports">https://learn.microsoft.com/en-us/defender-for-identity/security-assessment#assessment-reports</a></li>
<li>Full list of the 44 Alerts that are being checked on your behalf when fully deployed: <a href="https://learn.microsoft.com/en-us/defender-for-identity/alerts-overview">https://learn.microsoft.com/en-us/defender-for-identity/alerts-overview</a></li>
<li>If you do not use the default Administrator account (ideally have it disabled?) then please add it to the Honeytoken account list: <a href="https://learn.microsoft.com/en-us/defender-for-identity/entity-tags#honeytoken-tags">https://learn.microsoft.com/en-us/defender-for-identity/entity-tags#honeytoken-tags</a></li>
<li>Audit checking via Sentinel for MDI - <a href="https://thalpius.com/2022/12/14/microsoft-defender-for-identity-auditing-checker-using-sentinel">https://thalpius.com/2022/12/14/microsoft-defender-for-identity-auditing-checker-using-sentinel</a></li>
</ul>
<h2 id="troubleshooting">Troubleshooting</h2>
<ul>
<li><a href="https://learn.microsoft.com/en-us/defender-for-identity/troubleshooting-known-issues">https://learn.microsoft.com/en-us/defender-for-identity/troubleshooting-known-issues</a></li>
<li><a href="https://learn.microsoft.com/en-us/defender-for-identity/troubleshooting-using-logs">https://learn.microsoft.com/en-us/defender-for-identity/troubleshooting-using-logs</a></li>
</ul>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.e5c33ebb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.51d95adb.min.js"></script>
      
    
  </body>
</html>